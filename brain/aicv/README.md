# 체스 데이터셋 수집 도구

카메라로 체스판 이미지를 캡처하고 8x8 그리드로 라벨링하여 ML 학습용 데이터셋을 생성하는 웹 인터페이스입니다.

## 기능

- 📸 **실시간 카메라 스트리밍**: 원본 및 와핑된 체스판 실시간 미리보기
- 🖼️ **프레임 캡처**: 현재 체스판 상태를 이미지로 저장
- 🏷️ **인터랙티브 라벨링**: 8x8 그리드를 클릭하여 각 칸의 기물 라벨링 (빈 칸/흰색/검은색)
- 💾 **CSV 저장**: 라벨을 CSV 파일로 저장 (ML 학습용 형식)
- 📂 **프레임 로드**: 기존 프레임과 라벨을 불러와서 수정 가능

## 설치

필요한 패키지가 이미 설치되어 있어야 합니다:

```bash
pip install flask opencv-python numpy pandas
```

## 사용 방법

### 1. 웹 서버 실행

```bash
cd /home/chess/Desktop/ChessRobot/brain/aicv
python3 dataset_collector.py
```

또는 옵션 지정:

```bash
python3 dataset_collector.py \
    --port 5004 \
    --images-dir images \
    --labels-dir labels \
    --camera-index 0
```

### 2. 브라우저에서 접속

웹 서버가 시작되면 브라우저에서 다음 주소로 접속:

```
http://localhost:5004
```

또는 라즈베리파이의 IP 주소로 접속:

```
http://192.168.x.x:5004
```

### 3. 데이터 수집 절차

1. **프레임 캡처**: "📸 프레임 캡처" 버튼을 클릭하여 현재 체스판 상태를 이미지로 저장
2. **라벨링**: 8x8 그리드의 각 칸을 클릭하여 라벨 지정
   - 1회 클릭: 빈 칸 (empty)
   - 2회 클릭: 흰색 기물 (white)
   - 3회 클릭: 검은색 기물 (black)
   - 4회 클릭: 다시 빈 칸 (반복)
3. **라벨 저장**: "💾 라벨 저장" 버튼을 클릭하여 CSV 파일로 저장
4. **다음 프레임**: 체스판 상태가 변경되면 1번부터 반복

### 4. 저장되는 파일

#### 이미지 파일
- 위치: `images/` 디렉토리
- 형식: `frame01.jpg`, `frame02.jpg`, ...

#### 라벨 파일
- 위치: `labels/` 디렉토리
- 형식: `frame01.csv`, `frame02.csv`, ...
- CSV 형식:
  ```csv
  ,1,2,3,4,5,6,7,8
  a,0,0,0,0,0,0,0,0
  b,0,0,0,0,0,0,0,0
  ...
  ```
  - `0`: 빈 칸
  - `1`: 흰색 기물
  - `2`: 검은색 기물

## 명령줄 옵션

```
--port PORT              웹 서버 포트 (기본값: 5004)
--images-dir DIR         이미지 저장 디렉토리 (기본값: images)
--labels-dir DIR         라벨 저장 디렉토리 (기본값: labels)
--camera-index INDEX     카메라 인덱스 (기본값: 자동 탐색)
```

## 웹 인터페이스 기능

### 버튼

- **📸 프레임 캡처**: 현재 체스판을 이미지로 저장
- **💾 라벨 저장**: 현재 라벨을 CSV 파일로 저장
- **📂 프레임 로드**: 기존 프레임 번호를 입력하여 불러오기
- **🗑️ 라벨 초기화**: 현재 라벨을 모두 빈 칸으로 초기화

### 실시간 스트림

- **원본 카메라**: 카메라에서 직접 받은 원본 이미지
- **와핑된 체스판**: 초록 마커를 찾아서 와핑한 체스판 이미지

### 라벨링 그리드

- 8x8 체스판 그리드
- 각 칸을 클릭하여 라벨 변경
- 현재 라벨 상태 표시 (빈 칸/흰색/검은색 개수)

## 데이터셋 구조

수집된 데이터는 다음과 같은 구조로 저장됩니다:

```
aicv/
├── images/
│   ├── frame01.jpg
│   ├── frame02.jpg
│   └── ...
└── labels/
    ├── frame01.csv
    ├── frame02.csv
    └── ...
```

이 데이터는 ML 모델 학습에 바로 사용할 수 있습니다.

## 문제 해결

### 카메라가 인식되지 않음
- 카메라가 연결되어 있는지 확인
- `--camera-index` 옵션으로 다른 인덱스 시도
- `ls /dev/video*` 명령으로 사용 가능한 카메라 확인

### 와핑된 체스판이 표시되지 않음
- 초록 마커가 체스판 모서리에 제대로 배치되어 있는지 확인
- 조명 조건 확인 (너무 밝거나 어두우면 마커 감지 실패)

### 라벨 저장 실패
- `labels/` 디렉토리에 쓰기 권한이 있는지 확인
- pandas가 설치되어 있는지 확인: `pip install pandas`

## 참고

- 기존 CV 코드 (`brain/cv/`)를 기반으로 제작되었습니다
- 카메라 설정은 `USBCapture` 클래스를 사용합니다
- 체스판 와핑은 `picam_stable.py`의 함수를 사용합니다

